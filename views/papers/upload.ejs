<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Upload Paper | PaperVault</title>

  <!-- Bootstrap -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >

  <!-- Page CSS -->
  <link rel="stylesheet" href="/css/uploadPaper.css">
  <link rel="stylesheet" href="/css/homepage.css">
</head>
<body>

<!-- HEADER -->
<header class="pv-header">
  <div class="pv-header-container">

    <a href="/university" class="pv-brand">üìö PaperVault</a>


    <div class="pv-auth">
       <% if (!currentUser) { %>
    <!-- NOT LOGGED IN -->
    <a href="/login" class="pv-auth-link">Login</a>
    <a href="/register" class="pv-auth-link pv-register">Register</a>

  <% } else { %>
    <!-- LOGGED IN -->
    <a href="/logout" class="pv-auth-link pv-logout">Logout</a>
  <% } %>
    </div>

  </div>
</header>


<main class="page-container">

  <div class="top-back-link">
    <a href="javascript:history.back()" class="back-link">‚Üê Back</a>
  </div>

  <h1 class="page-title">Upload Question Paper</h1>
  <p class="page-subtitle">
    Please upload a valid PDF for the selected course, specialization, and subject.
  </p>

  <div class="upload-card">

    <form action="/papers" method="POST" enctype="multipart/form-data">

      <!-- CONTEXT -->
      <input type="hidden" name="university" value="<%= query.university %>">
      <input type="hidden" name="course" value="<%= query.course %>">

      <!-- TITLE -->
      <div class="mb-3">
        <label class="form-label">Paper Code</label>
        <input
          type="text"
          name="title"
          class="form-control"
          placeholder="e.g. CS301"
          required
        >
      </div>

      <!-- BRANCH / SPECIALIZATION -->
      <div class="mb-3">
        <label id="branch-label" class="form-label">Branch</label>
        <select id="branch" name="branch" class="form-select" required>
          <option value="">Select</option>
        </select>
      </div>

      <!-- YEAR & SEM -->
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label">Year</label>
          <select id="year" name="year" class="form-select" required>
            <option value="">Select Year</option>
            <option value="1st">1st</option>
            <option value="2nd">2nd</option>
            <option value="3rd">3rd</option>
            <option value="4th">4th</option>
          </select>
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label">Semester</label>
          <select id="semester" name="semester" class="form-select" required>
            <option value="">Select Semester</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
          </select>
        </div>
      </div>

      <!-- SUBJECT -->
      <div class="mb-3">
        <label class="form-label">Subject</label>
        <select id="subject" name="subject" class="form-select" required>
          <option value="">Select Subject</option>
        </select>
      </div>

      <!-- FILE -->
      <div class="mb-4">
        <label class="form-label">Question Paper (PDF only)</label>
        <input
          type="file"
          name="paperFile"
          class="form-control"
          accept="application/pdf"
          required
        >
      </div>

      <button type="submit" class="btn btn-primary upload-btn">
        Upload Paper
      </button>

    </form>
  </div>

</main>

<!-- SUBJECT DATA -->
<script type="application/json" id="subject-data">
  <%- JSON.stringify(subjectData) %>
</script>

<script>
  const subjectData = JSON.parse(
    document.getElementById("subject-data").textContent
  );

  const courseName = "<%= query.course %>";
  const branchSelect = document.getElementById("branch");
  const yearSelect = document.getElementById("year");
  const semSelect = document.getElementById("semester");
  const subjectSelect = document.getElementById("subject");
  const branchLabel = document.getElementById("branch-label");

  /* ===== LABEL BASED ON COURSE ===== */
  const labelMap = {
    BTech: "Branch",
    MTech: "Specialization",
    MBA: "Specialization",
    MCA: "Track",
    BSc: "Subject"
  };

  if (labelMap[courseName]) {
    branchLabel.textContent = labelMap[courseName];
  }

  /* ===== LOAD BRANCHES / SPECIALIZATIONS ===== */
  if (subjectData[courseName]) {
    Object.keys(subjectData[courseName]).forEach(key => {
      const opt = document.createElement("option");
      opt.value = key;
      opt.textContent = key;
      branchSelect.appendChild(opt);
    });
  }

  function updateSubjects() {
    subjectSelect.innerHTML = "<option value=''>Select Subject</option>";

    const branch = branchSelect.value;
    const year = yearSelect.value;
    const sem = semSelect.value;

    if (
      subjectData[courseName] &&
      subjectData[courseName][branch] &&
      subjectData[courseName][branch][year] &&
      subjectData[courseName][branch][year][sem]
    ) {
      subjectData[courseName][branch][year][sem].forEach(subject => {
        const opt = document.createElement("option");
        opt.value = subject;
        opt.textContent = subject;
        subjectSelect.appendChild(opt);
      });
    }
  }

  branchSelect.addEventListener("change", updateSubjects);
  yearSelect.addEventListener("change", updateSubjects);
  semSelect.addEventListener("change", updateSubjects);
</script>

</body>
</html>

